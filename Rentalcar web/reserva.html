<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>RentalCar</title>
    <link href="style.css" rel="stylesheet" type="text/css"/>
<style>
body{
    overflow-x: hidden;
}
</style>
</head>
	<div class="row" >
         
        <!-- NavBar -->
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
              <a class="navbar-brand" href="index.html">
                 <div class="imagen">
                <img src="logo.png" class="img-fluid" alt="...">
                 </div>
            </a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                
                <ul class="navbar-nav">
                    
                  <li class="nav-item">
                    <button class="btn btn-sm btn-light" type="button">ABOUT US</button>
                  </li>
                  <li class="nav-item">
                    
					<a href="reserva.html"><button class="btn btn-sm btn-light" type="button">BOOKING</button></a>

                  </li>
                  <li class="nav-item">
                    <button class="btn btn-sm btn-light" type="button">SUGGESTIONS</button>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
           
	<div id="bookForm">
		<input id="vehiculo" type="file" onChange="loadDoc(event)">
		<label for="vehiculo">Fitxategiko datuak igo</label>
	</div>

	<table id="bookTable">
		<thead>
			<tr>
				<th>ID</th>
				<th>Marca</th>
				<th>Modelo</th>
				<th>Tipo</th>
				<th>Año</th>
				<th>Precio</th>
			</tr>
		</thead>
  
		<tbody>
			<tr>
				<td colspan="3" style="text-align: center">Erregistro gabe</td>
			</tr>
		</tbody>
	</table>	   
		   
	
    <form class="datos-personales">
        <label for="id">ID Vehiculo:</label>
        <input id="id" type="id" value=""/>
        <label for="dni">DNI:</label>
        <input id="dni" type="dni" value=""/>
		<label for="correo">Correo:</label>
        <input id="correo" type="correo" value=""/>
		
        <button type="button" id="boton-descargar">Descargar fichero</button>
    </form>
    
        
        <!-- Footer -->
        
<footer class="text-center text-lg-start  text-muted">
    <!-- Section: Social media -->
    <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
      <!-- Left -->
      <div class="me-5 d-none d-lg-block">
        <span>Get connected with us on social networks:</span>
      </div>
      <!-- Left -->
  
      <!-- Right -->
      <div>
        <a href="" class="me-4 text-reset">
            <i class="bi bi-facebook"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-google"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-linkedin"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-github"></i>
        </a>
      </div>
      <!-- Right -->
    </section>
    <!-- Section: Social media -->
  

  
    <!-- Copyright -->
    <div class="text-center p-4">
      © 2024 Copyright:
      <a class="text-reset fw-bold" href="https://www.rentalcars.com/">Rentalcars.com</a>
    </div>
    <!-- Copyright -->
  </footer>
  <!-- Footer -->
    </div>
<script>
	document.addEventListener('DOMContentLoaded', (e)=>{
 
    /**
     * Genera un objeto Blob, que contiene un archivo XML.
     * @returns Blob Objeto de tipo Blob con el archivo xml.
     */
    const generarBlobXml = function(){
 
        //Comenzamos por crear un XmlDocument
        const documento = document.implementation.createDocument('', '', null);
 
        //A este, le agregamos un elemento raiz, tal y como
        //cuando manipulamos el DOM:
        const raiz = documento.createElement('peticion');
        documento.appendChild(raiz);
 
        //El elemento raiz debe ser único, pero dentro de él
        //podemos agregar cualquier cantidad de elementos hijos:
        //Usaremos la propiedad textContent para que automáticamente "escape"
        //los caracteres que no pueden incluirse directamente en el XML
        const id = documento.createElement('id');
        id.textContent = document.querySelector('#id').value;
        raiz.appendChild(id);
		
		const dni = documento.createElement('dni');
        dni.textContent = document.querySelector('#dni').value;
        raiz.appendChild(dni);
 
        const correo = documento.createElement('correo');
        correo.textContent = document.querySelector('#correo').value;
        raiz.appendChild(correo);
		
 
        //Para el blob, necesitamos convertir el documento XML en una cadena
        //de texto. Usamos la propiedad outerHTML del elemento raiz
        const partes = [raiz.outerHTML];
 
        //El tipo MIME para xml con contenido personalizado como este
        //debe ser "text/xml"
        const blobArchivo = new Blob(partes, { type: 'text/xml'} );
 
        return blobArchivo;
 
    }
 
 
    /**
     * Inicia la descarga del archivo en el navegador. 
     * Dependiendo de la configuración del navegador, 
     * este descarga el archivo automáticamente, o mostrará
     * el cuadro de dialogo "Guardar Cómo"
     * @param {Blob} archivo Objeto tipo Blob para descargar. 
     * @param {string} nombre Nombre por defecto para el archivo 
     */
    const descargarArchivo = function(archivo, nombre){
 
        //Creamos un link
        const guardar = document.createElement('a');
        //Le asigna el ObjectURL que "apunta" al Blob
        guardar.href = URL.createObjectURL(archivo);
        //Preferiblemente descargar (con el nombre indicado), 
        //sino, entonces que por lo menos abra en otra ventana
        guardar.download = nombre || 'archivo.dat'; 
        guardar.target = '_blank'; 
         
        //Simulamos un clic del usuario
        //no es necesario agregar el link al DOM
        var clicEvent = new MouseEvent('click', {
            'view': window,
            'bubbles': true,
            'cancelable': true
        });
        guardar.dispatchEvent(clicEvent);
 
        //Al final removemos el DataURL para liberar recursos
        URL.revokeObjectURL(guardar.href);
 
    }
 
    //Al hacer clic: generar el archivo
    document.querySelector('#boton-descargar').addEventListener('click', (e) =>{
 
        //Primero generamos el Blob
        const archivo = generarBlobXml();
 
        //Y luego lo descargamos
		let str1 = 'peticion';
		let result = str1.concat(Date.now(), ".xml");
		descargarArchivo(archivo, result);
 
    });
 
	});
	
	//SUBIR ARCHIVO XML
	function loadDoc(e) {
  const file = e.target.files[0];

  if (!file) {
    throw new Error('You need to choose an XML file first')
    alert('You need to choose an XML file first')
    return false
  }

  readDoc(file).then(parseDoc).then(showDocInTable).catch(onError)
}

function readDoc(file) {
  const reader = new FileReader()

  return new Promise((ok) => {
    reader.readAsText(file)
    reader.onload = function() {
      ok(reader.result)
    }
  })
}

function parseDoc(rawXML) {
  const parser = new DOMParser()
  const xml = parser.parseFromString(rawXML, 'text/html')
  return xml
}

function showDocInTable(xml) {
  const table = document.querySelector('#bookTable > tbody')
  const datasource = xml.querySelector('peticion')
  const peticion = datasource.querySelectorAll('vehiculo')

  table.removeChild(table.children[0])

  Array.from(peticion).map((vehiculo, i) => {
    const tr = document.createElement('tr')
    const id = tagToData(vehiculo.querySelector('id'))
    const marca = tagToData(vehiculo.querySelector('marca'))
    const modelo = tagToData(vehiculo.querySelector('modelo'))
	const tipo = tagToData(vehiculo.querySelector('tipo'))
	const ano = tagToData(vehiculo.querySelector('ano'))
	const precio = tagToData(vehiculo.querySelector('precio'))

    tr.append(id, marca, modelo, tipo, ano, precio)
    table.appendChild(tr)
  })
}

function tagToData(tag) {
  const td = document.createElement('td')
  td.textContent = tag.textContent
  return td
}

function onError(reason) {
  console.error(reason)
}
	</script>
</html>